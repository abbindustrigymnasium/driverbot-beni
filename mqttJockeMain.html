<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <title>mqtt-demo: A simple web application that can subscribe to topics from an MQTT broker over websockets</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
   <script>
      let client, topic;

      function startConnect() {
         let clientID = "clientID_" + parseInt(Math.random() * 100);
         let host = document.getElementById("host").value;
         let port = document.getElementById("port").value;
         document.getElementById("messages").innerHTML += '<span>Connecting to: ' + host + ' on port: ' + port + '</span><br/>';
         client = new Paho.MQTT.Client(host, Number(port), clientID);
         client.onConnectionLost = onConnectionLost;
         client.onMessageArrived = onMessageArrived;
         client.connect({
            userName: "benijuste.ngabire@hitachigymnasiet.se",
            password: "brok",
            onSuccess: onConnect,
            onFailure: onFail,
         });
      }

      function onFail() {
         document.getElementById("messages").innerHTML += '<span>ERROR: Connection failed.</span><br/>'
      }

      function onConnect() {
         topic = "benijuste.ngabire@hitachigymnasiet.se/" + document.getElementById("topic").value;
         console.log(topic);
         document.getElementById("messages").innerHTML += '<span>Subscribing to: ' + topic + '</span><br/>';
         client.subscribe(topic);
         sendMessage("Hello World!");
      }

      function sendMessage(message) {
         let mqttMessage = new Paho.MQTT.Message(message);
         mqttMessage.destinationName = topic;
         client.send(mqttMessage);
      }

      function onSend() {
         let message = document.getElementById("newMessage").value;
         console.log(message);
         sendMessage(message);
      }

      function onConnectionLost(responseObject) {
         document.getElementById("messages").innerHTML += '<span>ERROR: Connection lost</span><br/>';
         if (responseObject.errorCode !== 0) {
            document.getElementById("messages").innerHTML += '<span>ERROR: ' + responseObject.errorMessage + '</span><br/>';
         }
      }

      function onMessageArrived(message) {
        
         if (message.destinationName === "benijuste.ngabire@hitachigymnasiet.se/gamepad") {
            document.getElementById("gamepad-messages").innerHTML = message.payloadString ;
         }
      }

      function startDisconnect() {
         client.disconnect();
         document.getElementById("messages").innerHTML += '<span>Disconnected</span><br/>';
      }
   </script>
</head>
<body>
   <div class="wrapper">
      <h1>mqtt-demo</h1>
      <form id="connection-information-form">
         <b>Hostname or IP Address:</b>
         <input id="host" type="text" name="host" value="maqiatto.com"><br>
         <b>Port:</b>
         <input id="port" type="text" name="port" value="8883"><br>
         <b>Topic:</b>
         <input id="topic" type="text" name="topic" value=""><br><br>
         <input type="button" onclick="startConnect()" value="Connect">
         <input type="button" onclick="startDisconnect()" value="Disconnect"><br><br>
         <input id="newMessage" type="text" name="newMessage" value="">
         <input type="button" onclick="onSend()" value="Send">
      </form>
      <div id="messages"></div>
      <div id="received-messages"></div>
      <div id="gamepad-messages"></div>
   </div>
</body>
</html>
